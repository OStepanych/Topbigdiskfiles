Предлагаю вам сохранить в закладки простой и удобный скрипт для Linux, который поможет быстро разобраться на сервере, кто и чем занял свободное место — topdiskconsumer (https://github.com/klazarsk/storagetoolkit). Единственный файл в репозитории, кроме README и есть этот скрипт.

Скрипт автоматически определяет mount point, с которого он запущен. Далее идёт в корень диска и вычисляет top:

▪️ 20 самых больших файлов 
▪️ 20 самых объёмных директорий
▪️ 20 самых больших файлов, старше 30-ти дней
▪️ 20 самых больших удалённых файлов с незакрытыми handles (удалёнными, но реально всё ещё занимающими место, потому что дескриптор не закрыт)

При этом скрипт ничего не ставит и не использует сторонний софт. Всё реализовано через привычный функционал системы. Например, топ 20 директорий вычисляет вот такая конструкция:

# du -hcx --max-depth=6 / 2>/dev/null | sort -rh | head -n 20

Топ 20 файлов:

# find / -mount -ignore_readdir_race -type f -exec du -h "{}" + 2>&1 \
| sort -rh | head -n 20

Топ 20 старых файлов:

# find / -mount -ignore_readdir_race -type f -mtime +30 -exec du -h "{}" + 2>&1 \
| sort -rh | head -20

Для удалённых файлов длинная конструкция с использованием lsof. Не буду всю её приводить, можете сами в скрипте посмотреть функцию fnLargestUnlinked. 

Размер топа задаётся переменной intNumFiles в самом начале скрипта. Можете изменить при желании на любое другое число. Оно же указывается, если запустить скрипт с ключом -l. Описание всех возможностей можно посмотреть вот так:
# ./topdiskconsumer --help
Там много всего полезного. 

Скрипт очень понравился, сразу сохранил себе в коллекцию. Когда куда-то утекло место на сервере, поможет быстро оценить обстановку, не вспоминая все эти команды самостоятельно. Я их в разное время и в разных публикациях уже приводил здесь. Причём все, что используются. А тут всё в одном месте собрали.
 
 
                                Запуск
 
/полный_путь_до_скрипта/topdiskconsumer         запуск скрипта с параметрами по умолчанию
/полный_путь_до_скрипта/topdiskconsumer -l 5    запуск скрипта с опцией l (первые 5 строк)

                          
                           Файл README.md  перевод

Kims Storage Toolkit

Документация
Это черновик документации; среди дальнейших уточнений будут обновления документации. Это просто копия и вставка экрана справки:

topdiskconsumer - Отчет о пользователях верхнего диска [версия 0.6]

Этот скрипт сообщает о главных потребителях дисков, чтобы помочь определить, где требуется очистка.

Использование
topdiskconsumer

При выполнении без аргументов скрипт определит точку монтирования
, содержащую текущий рабочий каталог, затем выполнит отчет, начиная
с точки монтирования, идентифицируя и перечисляя 20 самых больших файлов, а также
топ-20 самых больших каталогов, а затем топ-20 самых больших файлов возрастом более 30
дней.
Аргументы командной строки:

-f --format [формат]
Отформатируйте заголовки с добавлением жирной разметки для использования в билетной системе.

Допустимые параметры:
заголовки в формате html с тегами html, выделенными жирным
шрифтом, bbcode - заголовки в формате bbcode, выделенные жирным
шрифтом, ansi - заголовки в формате [ПО умолчанию] с тегами ansi, выделенными жирным шрифтом {для терминалов и
richtext. Этот экран справки всегда отображается в формате ANSI.}

-p --path [путь] явно задает путь для запуска (он будет идентифицировать монтируемый
разместите указанный каталог и запустите с этой точки монтирования. Взаимно
эксклюзивно с опцией -A | --alt-root.


-A --alt-root - рассматривать указанный каталог как альтернативный корневой; другими словами
сообщайте о верхних потребителях диска из указанной точки, глубже; не проверяйте
фактическую точку монтирования. Музыкально эксклюзивный с опцией --path. Этот параметр очень
удобен при использовании в сочетании с привязкой монтирования к /, если вы подозреваете, что монтирование скрывает
от просмотра пользователей больших дисков.

-l --ограничение [количество]
Отчет ограничен верхним [числом] самых больших файлов для каждого раздела отчета [по умолчанию=20]

-t --timeout [продолжительность] установите тайм-аут для каждого раздела отчета. Для
пример, 60 единица измерения времени по умолчанию - секунды, так что это будет тайм-аут через 60 секунд,
30 секунд (для 30-секундного тайм-аута), 15 м (тайм-аут через 15 минут), 2 часа (тайм-аут через
2 часа). Принимает те же значения, что и команда _timeout_. Пожалуйста, обратите внимание, что указание
тайм-аута приведет к неполным и, вероятно, неточным и вводящим в заблуждение результатам.

-o --skipold пропускает отчет о файлах возрастом более 30 дней

-d --skipdir пропустить отчет о крупнейших каталогах

-m --skipmeta опускает метаданные, такие как резервные блоки, время начала и окончания, продолжительность и т.д.

-u --skipunlinked пропустил отчет об открытых дескрипторах удаленных файлов

-f --skipfiles пропустить отчет о самых больших файлах

-t --temp [каталог] Укажите альтернативный временный каталог, когда /tmp слишком заполнен для временных
файлов, чтобы разрешить генерацию отчета.

-v --версия отобразите номер версии, затем выйдите.
Пожалуйста, обратите внимание: модуль отчета Top [number] Directories включает в себя "общий" размер. Это сделано намеренно. Этот скрипт может обращаться только к файлам, к которым у вас есть доступ; для его выполнения используйте sudo или root. В качестве альтернативы вы могли бы изменить сценарий с правами suid, но это может представлять угрозу безопасности в финансовой, медицинской и правительственной среде из-за раскрытия конфиденциальных имен файлов непривилегированным пользователям. Выбирайте suid с осторожностью.


## _topdiskconsumer_ Известные проблемы/список задач
- [ ] getopts предлагает улучшенную обработку аргументов
- [ ] нужна справочная страница
- [ ] требуется rpm (сделаю это после написания справочных страниц)

Дефекты P1:
- [ ] самые большие удаленные открытые файлы: не работает в Ubuntu 20: список дескрипторов открытых файлов не работает в Ubuntu (в настоящее время я нахожусь в Далласе, где Red Hat tech exchange рассмотрит проблему на моей неделе виртуальных машин Ubuntu, начиная с 05 февраля). Причина: lsof, распространяемый вместе с Ubuntu, по умолчанию отображает другой формат. Планирую повторно протестировать на RHEL, Ubuntu и (openSUSE) Tumbleweed. Ранее тестировался на RHEL и более старых версиях Tumbleweed и первоначально был разработан однострочный на Tumbleweed.


# Блог системного администратора в красной шляпе

https://www.redhat.com/sysadmin/free-storage-space-linux

# Важное примечание:

Re: автоматическая очистка

Я слышу ваши просьбы и предложения, и хотя в принципе я согласен, я видел, как слишком много младших администраторов неправильно
применяли инструменты "швейцарского армейского ножа", что приводило к сбоям в хранении, включая полное удаление хранилища из
-под действующих баз данных на производственных серверах.

## Обновление:

После обсуждения с коллегой и обдумывания этого, в качестве решения для снижения риска, но также позволяющего выполнять очистку, я решил предоставить спецификацию конфигурационного файла, позволяющую выполнять автоматическую очистку, стремясь предотвратить грубое неправильное использование утилиты младшими администраторами. Это позволит использовать скрипт в финансовых учреждениях, размещенных в компаниях, где поддержка ограничена действиями "только для чтения", а также обеспечит автоматическую очистку на рабочих станциях и средах разработки/промежуточной подготовки.

Расчетное время прибытия: к концу 2кв2023

# Дорожная карта

Грядущий март 2023 года

